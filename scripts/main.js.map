{"version":3,"file":"main.js","sources":["../_scripts/main.js"],"sourcesContent":["/* global $ */\n\n'use strict';\nwindow.$ = document.querySelectorAll.bind(document);\n\nNode.prototype.on = window.on = function (name, fn) {\n  this.addEventListener(name, fn.bind(this));\n};\n\nNodeList.prototype.__proto__ = Array.prototype;\n\nNodeList.prototype.on = NodeList.prototype.addEventListener = function (name, fn) {\n  this.forEach(function (elem) {\n    elem.on(name, fn);\n  });\n};\n\nfunction fetchAndReplace(url, selector) {\n\n\tif (!window.fetch) {\n\t\treturn location.assign(url);\n\t}\n\tfetch(url)\n\t\t.then(function(response) {\n\t\t\treturn response.text();\n\t\t})\n\t\t.then(function(body) {\n\t\t\tconst htmlDoc = (new DOMParser()).parseFromString(body, 'text/html');\n\t\t\tconst replacer = htmlDoc.querySelectorAll(selector);\n\t\t\tconst toReplace = $(selector).slice(0, replacer.length);\n\t\t\ttoReplace.forEach(function (el, i) {\n\t\t\t\tel.parentNode.replaceChild(replacer[i], el);\n\t\t\t});\n\t\t\treturn replacer;\n\t\t})\n\t\t.catch(function () {\n\t\t\tlocation.assign(url);\n\t\t});\n}\n\n(function () {\n\tfunction sendSWMessage(message) {\n\n\t\t// This wraps the message posting/response in a promise, which will resolve if the response doesn't\n\t\t// contain an error, and reject with the error if it does. If you'd prefer, it's possible to call\n\t\t// controller.postMessage() and set up the onmessage handler independently of a promise, but this is\n\t\t// a convenient wrapper.\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tconst messageChannel = new MessageChannel();\n\t\t\tmessageChannel.port1.onmessage = function(event) {\n\t\t\t\tif (event.data.error) {\n\t\t\t\t\treject(event.data.error);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(event.data);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// This sends the message data as well as transferring messageChannel.port2 to the service worker.\n\t\t\t// The service worker can then use the transferred port to reply via postMessage(), which\n\t\t\t// will in turn trigger the onmessage handler on messageChannel.port1.\n\t\t\t// See https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage\n\t\t\tnavigator.serviceWorker.controller.postMessage(message, [messageChannel.port2]);\n\t\t});\n\t}\n\n\tfunction storeStaticResources(staticResources) {\n\n\t\tconst action = 'STORE_ALL';\n\t\tconst id = action + '_' + Date.now();\n\n\t\treturn sendSWMessage({\n\t\t\t\taction: action,\n\t\t\t\turls: JSON.stringify(staticResources),\n\t\t\t\tid: id\n\t\t\t});\n\t}\n\n\tfunction offlineLocalLinks() {\n\t\tconst localUrls = $('a')\n\t\t\t.filter(function (i) {\n\t\t\t\treturn (\n\n\t\t\t\t\t// Cache all https local resources\n\t\t\t\t\ti.hostname === location.hostname &&\n\t\t\t\t\ti.protocol === 'https'\n\t\t\t\t);\n\t\t\t})\n\t\t\t.map(function (i) {\n\t\t\t\treturn i.toString();\n\t\t\t});\n\n\t\treturn storeStaticResources(localUrls)\n\t\t\t.then(function (result) {\n\t\t\t\tif (result.success) {\n\t\t\t\t\tconsole.log('Successfully cached resources');\n\t\t\t\t} else {\n\t\t\t\t\tconsole.log('Some resourcecs failed to cache');\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t});\n\t}\n\n\tif ('serviceWorker' in navigator && location.protocol === 'https:') {\n\t\tnavigator.serviceWorker.register('/sw.js', { scope: '/' })\n\t\t\t.then(function(reg) {\n\t\t\t\tconsole.log('sw registered', reg);\n\t\t\t}).catch(function(error) {\n\t\t\t\tconsole.log('sw registration failed with ' + error);\n\t\t\t});\n\n\t\twindow.addEventListener('message', function (e) {\n\t\t\tif( e.data.action === 'ASSET_REFRESHED') {\n\t\t\t\tif (e.data.url === location.toString()) {\n\t\t\t\t\tconsole.log('Refreshing ' + e.data.url);\n\t\t\t\t\tfetchAndReplace(e.data.url, 'body');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (navigator.serviceWorker.controller) {\n\t\t\twindow.offlineLocalLinks = offlineLocalLinks;\n\t\t\twindow.storeStaticResources = storeStaticResources;\n\t\t\tconsole.log('Offlining Available');\n\t\t\t$('.hero-offline')[0].style.display = 'inline';\n\t\t\t$('.hero-offline a').on('click', function () {\n\t\t\t\tthis.innerHTML = 'Caching';\n\t\t\t\t(window.offlineLinks ? storeStaticResources(window.offlineLinks) : offlineLocalLinks())\n\t\t\t\t.then(function (data) {\n\t\t\t\t\tthis.innerHTML = data.success ? 'Cached' : 'Failed to Cache';\n\t\t\t\t}.bind(this));\n\t\t\t});\n\t\t}\n\t}\n\n\t$('video')\n\t.forEach(function (video) {\n\t\tvideo.preload = 'none';\n\t\tvideo.autoplay = false;\n\t\tvideo.src = video.dataset.src;\n\t});\n\n\tfunction wrapHeader(node, i) {\n\t\tconst name = i + '-' + node.textContent.toLowerCase().trim().replace(/[^a-z]/g, '-').replace(/-+$/, '');\n\t\tconst a = document.createElement('a');\n\t\ta.name = name;\n\t\ta.id = name;\n\t\ta.href = '#' + name;\n\t\ta.style.color = \"inherit\";\n\t\ta.innerHTML = node.innerHTML;\n\t\tnode.innerHTML = '';\n\t\tnode.appendChild(a);\n\t}\n\n\t$('article h1,h2,h3,h4,h5,h6').forEach(wrapHeader);\n})();\n"],"names":[],"mappings":"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"}